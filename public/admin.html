<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Leads Raros Capital</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #bfa34a;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      background-color: #d9534f;
      color: white;
      border: none;
      border-radius: 4px;
    }

    #authSection {
      text-align: center;
      margin-top: 100px;
    }

    input[type="password"] {
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }

    .btn-excluir {
      background-color: #d9534f;
    }
  </style>
</head>
<body>

<div id="authSection">
  <h2>Área Restrita</h2>
  <p>Digite a senha para acessar os leads:</p>
  <input type="password" id="adminPass" placeholder="Senha de acesso" />
  <br>
  <button onclick="authAdmin()">Entrar</button>
</div>

<div id="leadsSection" style="display:none;">
  <h1>Leads Recebidos</h1>
  <table id="leadsTable">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>WhatsApp</th>
        <th>Valor (R$)</th>
        <th>Data</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC2RmhrsTe-o1jE3pVbFLKDl11m8zFW7tk",
    authDomain: "site-raros.firebaseapp.com",
    projectId: "site-raros",
    storageBucket: "site-raros.appspot.com",
    messagingSenderId: "610375954172",
    appId: "1:610375954172:web:6c1cf57ef39d6e93a1f179",
    measurementId: "G-S3ZLSEE4GP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.authAdmin = async function () {
    const senha = document.getElementById('adminPass').value;
    const senhaCorreta = "Cuchi@rtur2015"; // Troque por senha real

    if (senha !== senhaCorreta) {
      alert("Senha incorreta!");
      return;
    }

    document.getElementById('authSection').style.display = 'none';
    document.getElementById('leadsSection').style.display = 'block';

    carregarLeads();
  }

  async function carregarLeads() {
    const tabela = document.querySelector('#leadsTable tbody');
    tabela.innerHTML = "<tr><td colspan='6'>Carregando...</td></tr>";

    try {
      const querySnapshot = await getDocs(collection(db, "leads"));
      let html = "";

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const id = docSnap.id;

        html += `
          <tr>
            <td>${data.nome}</td>
            <td>${data.email}</td>
            <td>${data.telefone}</td>
            <td>R$ ${Number(data.valor).toLocaleString('pt-BR', {minimumFractionDigits:2})}</td>
            <td>${new Date(data.criadoEm).toLocaleString('pt-BR')}</td>
            <td><button class="btn-excluir" onclick="excluirLead('${id}')">Excluir</button></td>
          </tr>`;
      });

      tabela.innerHTML = html || "<tr><td colspan='6'>Nenhum lead encontrado.</td></tr>";
    } catch (e) {
      console.error("Erro ao buscar leads", e);
      tabela.innerHTML = "<tr><td colspan='6'>Erro ao carregar dados.</td></tr>";
    }
  }

  window.excluirLead = async function (id) {
    if (!confirm("Tem certeza que deseja excluir este lead?")) return;

    try {
      await deleteDoc(doc(db, "leads", id));
      alert("Lead excluído com sucesso.");
      carregarLeads();
    } catch (error) {
      console.error("Erro ao excluir lead:", error);
      alert("Erro ao excluir lead.");
    }
  }
</script>

</body>
</html>
