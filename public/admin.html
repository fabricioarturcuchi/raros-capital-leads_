<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Raros Capital</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    #loginForm, #leadsSection {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      background-color: #bfa34a;
      color: white;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    table {
      width: 100%;
      margin-top: 25px;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
    }
    th {
      background: #bfa34a;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
  </style>
</head>
<body>

<div id="loginForm">
  <h2>Login Administrativo</h2>
  <input type="email" id="email" placeholder="E-mail de acesso" />
  <input type="password" id="senha" placeholder="Senha" />
  <button onclick="login()">Entrar</button>
  <p id="loginMsg" style="color:red;text-align:center;margin-top:10px;"></p>
</div>

<div id="leadsSection" style="display:none;">
  <h1>Leads Recebidos</h1>
  <table id="leadsTable">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>WhatsApp</th>
        <th>Valor</th>
        <th>Data</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="logout()">Sair</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getFirestore, collection, getDocs, deleteDoc, doc
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import {
    getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC2RmhrsTe-o1jE3pVbFLKDl11m8zFW7tk",
    authDomain: "site-raros.firebaseapp.com",
    projectId: "site-raros",
    storageBucket: "site-raros.appspot.com",
    messagingSenderId: "610375954172",
    appId: "1:610375954172:web:6c1cf57ef39d6e93a1f179",
    measurementId: "G-S3ZLSEE4GP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  window.login = async function () {
    const email = document.getElementById('email').value.trim();
    const senha = document.getElementById('senha').value.trim();
    const msg = document.getElementById('loginMsg');

    try {
      await signInWithEmailAndPassword(auth, email, senha);
    } catch (error) {
      console.error("Erro de login", error);
      msg.textContent = "E-mail ou senha inválidos.";
    }
  }

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('leadsSection').style.display = 'block';
      carregarLeads();
    } else {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('leadsSection').style.display = 'none';
    }
  });

  window.logout = async function () {
    await signOut(auth);
  }

  async function carregarLeads() {
    const tabela = document.querySelector('#leadsTable tbody');
    tabela.innerHTML = "<tr><td colspan='6'>Carregando...</td></tr>";

    try {
      const querySnapshot = await getDocs(collection(db, "leads"));
      let html = "";

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const id = docSnap.id;

        html += `
          <tr>
            <td>${data.nome}</td>
            <td>${data.email}</td>
            <td>${data.telefone}</td>
            <td>R$ ${Number(data.valor).toLocaleString('pt-BR', {minimumFractionDigits:2})}</td>
            <td>${new Date(data.criadoEm).toLocaleString('pt-BR')}</td>
            <td><button onclick="excluirLead('${id}')">Excluir</button></td>
          </tr>`;
      });

      tabela.innerHTML = html || "<tr><td colspan='6'>Nenhum lead encontrado.</td></tr>";
    } catch (e) {
      console.error("Erro ao buscar leads", e);
      tabela.innerHTML = "<tr><td colspan='6'>Erro ao carregar dados.</td></tr>";
    }
  }

  window.excluirLead = async function (id) {
    if (!confirm("Tem certeza que deseja excluir este lead?")) return;

    try {
      await deleteDoc(doc(db, "leads", id));
      alert("Lead excluído com sucesso.");
      carregarLeads();
    } catch (error) {
      console.error("Erro ao excluir lead:", error);
      alert("Erro ao excluir lead.");
    }
  }
</script>

</body>
</html>
